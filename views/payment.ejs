<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Razorpay Payment</title>
</head>

<body>
  <h1>Test Razorpay Payment (Redirect Flow)</h1>
  <button id="payBtn">Pay Now</button>

  <script>
    document.getElementById("payBtn").addEventListener("click", async () => {
      try {
        // 1Ô∏ù‚É£ Create Order from backend
        const response = await fetch("https://taxutsav-ya03.onrender.com/api/orders/create-order", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODk5YmUyMWEyNzU0NWEwNTgyMThhZWUiLCJpYXQiOjE3NTY4MzQ2MjksImV4cCI6MTc1NjkyMTAyOX0.L18yylG3T79_1_hQR-FoVMEoKRkc6LJji4HeXHS0yPk`, // <-- send your login token here
          },
          body: JSON.stringify({
            items: [
              { name: "ITR Filing", description: "45 min expert advice", price: 500, quantity: 1 }
            ],
            paymentMethod: "upi",
          }),
        });

        const data = await response.json();
        if (!data.order) {
          alert("Failed to create order");
          return;
        }

        // 2Ô∏ù‚É£ Redirect user to Razorpay Hosted Checkout Page
        const razorpayKey = "<%= process.env.RAZORPAY_KEY_ID %>"; // injected by EJS
        const checkoutUrl =
          `https://api.razorpay.com/v1/checkout/embedded?key_id=${razorpayKey}&order_id=${data.order.razorpayOrderId}&redirect=true`;

        window.location.href = checkoutUrl; // üî¥ Important: redirect instead of rzp.open()
      } catch (err) {
        console.error("Payment Error:", err);
        alert("Something went wrong");
      }
    });
  </script>
</body>

</html>